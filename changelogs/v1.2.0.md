# Version 1.2.0 - Setting Model with GSI Support

**Release Date:** August 11, 2025  
**Type:** Minor Release

## üöÄ New Features

### Setting Model Implementation
- **New Setting Model**: Added comprehensive Setting model for storing various types of configuration data
- **Entity-based Ownership**: Uses `entityId` field for flexible ownership (users, posts, system, etc.)
- **JSON Value Storage**: Supports flexible JSON values using `AWSJSON` GraphQL type
- **Real-time Subscriptions**: Enabled for live setting updates

### Global Secondary Index (GSI) Support
- **Index Definition Framework**: Added `indexes` section to model JSON for defining DynamoDB GSIs
- **Three Optimized Indexes**:
  - `byEntityAndType`: Query all settings for a specific entity (ALL projection)
  - `byTypeAndKey`: Query settings by type across entities (INCLUDE projection)
  - `byActiveSettings`: Query active settings by recency (KEYS_ONLY projection)
- **Cost-Optimized Projections**: Different projection types for optimal storage and query costs

### Enhanced Security Model
- **Owner-based Access Control**: Automatic ownership verification through `entityId`
- **Group-based Permissions**: Support for users and admins groups
- **Default Deny Policy**: Secure by default with explicit allow rules

## üß™ Testing Infrastructure

### Comprehensive Test Suite
- **Unit Tests (20 tests)**: Model validation, index definitions, access control
- **Integration Tests (12 tests)**: Framework integration, security validation
- **E2E Tests (9 tests)**: Complete workflow validation, query patterns
- **Total Coverage**: 41 tests covering all aspects of the Setting model

### Test Infrastructure Improvements
- **Enhanced Jest Configuration**: Support for different test types
- **Test Scripts**: Dedicated scripts for unit, integration, E2E testing
- **Mock Support**: AWS SDK mocking for unit tests
- **Coverage Reporting**: HTML, LCOV, and text coverage reports

## üìä Model Features

### Setting Types Supported
- **User Settings**: Theme preferences, notifications, privacy
- **Post Settings**: Visibility, formatting, moderation
- **System Settings**: Global configuration, feature flags, maintenance

### Query Patterns Optimized
- Get all settings for a specific entity
- Find settings by type across entities  
- Query active settings by recency
- Owner-based filtering with authorization

## üîß Technical Implementation

### Model Structure
```json
{
  "name": "Setting",
  "properties": {
    "id": { "type": "ID", "required": true },
    "type": { "type": "String", "required": true },
    "key": { "type": "String", "required": true },
    "value": { "type": "AWSJSON", "required": true },
    "entityId": { "type": "ID", "required": true, "isOwner": true }
  },
  "indexes": {
    "byEntityAndType": { "partitionKey": "entityId", "sortKey": "type" },
    "byTypeAndKey": { "partitionKey": "type", "sortKey": "key" },
    "byActiveSettings": { "partitionKey": "isActive", "sortKey": "updatedAt" }
  }
}
```

### Generated GraphQL Operations
- `createSetting`, `updateSetting`, `deleteSetting`
- `getSetting`, `listSettings` with GSI-optimized filtering
- `onCreateSetting`, `onUpdateSetting`, `onDeleteSetting` subscriptions

## üìà Performance Optimizations

### Index Design
- **Partition Key Distribution**: Optimized for even data distribution
- **Sort Key Selection**: Enables range queries and filtering
- **Projection Optimization**: Minimizes storage costs while maintaining query performance

### Query Efficiency
- **GSI-based Queries**: All common query patterns use appropriate indexes
- **Minimal Data Transfer**: KEYS_ONLY projection for filtering queries
- **Complete Data Access**: ALL projection for entity-based queries

## üîí Security Enhancements

### Access Control Rules
- Users can create and read settings
- Owners can update and delete their own settings
- Admins have full access to all settings
- Default deny policy for unauthorized access

### Owner-based Security
- Automatic owner field population on create
- Pre-operation ownership verification
- JWT token integration for user identification

## üìù Documentation

### Seed Data Examples
- 6 example settings covering different types and use cases
- Proper ISO date formatting for timestamp fields
- Realistic JSON value structures

### Test Documentation
- Comprehensive test coverage documentation
- Query pattern examples
- Access control scenario validation

## üö¶ Breaking Changes
None - This is a purely additive release.

## üîÑ Migration Guide
No migration required. The Setting model is a new addition that doesn't affect existing models.

## üìã Files Added/Modified

### New Files
- `models/Setting.json` - Setting model definition
- `models/Setting.seed.json` - Seed data for testing
- `test/models/setting.test.ts` - Unit tests
- `test/integration/setting-model-integration.test.ts` - Integration tests
- `test/e2e/setting-workflow.test.ts` - E2E workflow tests
- `test/setup.ts` - Test environment setup

### Modified Files
- `package.json` - Added test scripts and dependencies
- `jest.config.js` - Enhanced test configuration

## üéØ Next Steps

### Framework Enhancements
- Automatic GSI generation in CDK stack
- GraphQL resolver generation for indexes
- Index-aware query optimization

### Additional Features
- Sparse index support
- Composite key indexes
- Index cost analysis tools

---

**Contributors:** Amazon Q  
**Review Status:** ‚úÖ All tests passing (41/41)  
**Deployment Status:** Ready for deployment
